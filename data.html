<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Chick Counterweight Dashboard</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


  <style>
    * {
      box-sizing: border-box;
      font-family: "Segoe UI", Tahoma, sans-serif;
    }

    @media (max-width: 768px) {
      th {
      font-size: 11px;
      }
    }

    /* ===== MOBILE CHART FIX ===== */
    @media (max-width: 768px) {
      .chart-container {
      height: 260px;
      }
    }

    @media (max-width: 768px) {
      .chart-container {
      height: 300px;
    }

    header h1 {
      font-size: 20px;
    }

    h2 {
      font-size: 18px;
    }
  }

    body {
      background: #f4f6f8;
      margin: 0;
      color: #333;
    }

    header {
      background: linear-gradient(135deg, #4B5320, #556B2F);
      color: white;
      padding: 20px 40px;
    }

    .container {
      padding: 40px;
      max-width: 1200px;
      margin: auto;
    }

    .card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.08);
      padding: 25px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;
      margin-top: 15px;
    }

    th, td {
      padding: 8px;
      text-align: center;
      border-bottom: 1px solid #e5e7eb;
      font-size: 13px;
    }

    th {
      background: #4B5320;
      color: white;
    }

    .chart-container {
      height: 400px;
      margin-top: 30px;
    }

    #status {
      margin-top: 15px;
      font-size: 14px;
      text-align: right;
      color: #6b7280;
    }

    /* ===== MOBILE TABLE SCROLL ===== */
    .table-scroll {
      width: 100%;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }

    .table-scroll table {
      min-width: 1100px; /* forces horizontal scroll */
    }

    /* ===== FIX MOBILE TABLE HEADER BREAKING ===== */
    th, td {
      white-space: nowrap;
    }

    table {
      table-layout: auto; /* override fixed layout */
    }

  </style>
</head>

<body>
<header>
    <h1>Chick Counterweight Monitor</h1>
    <nav>
      <a href="index.html">Home</a>
      <a href="project.html">Contact</a>
    </nav>
  </header>

<div class="container">
  <div class="card">

    <h2>Weekly Chicken Weight</h2>

    <!-- WEEK SELECTOR -->
    <label for="weekSelect"><strong>Select Week:</strong></label>
    <select id="weekSelect" style="margin-left:10px; padding:5px;"></select>

    <!-- TABLE -->
    <div class="table-scroll">
    <table id="sheetData">
      <thead></thead>
      <tbody></tbody>
    </table>
    </div>

    <!-- CHART -->
    <div class="chart-container">
      <canvas id="weightChart"></canvas>
    </div>

    <div id="status">Loading data...</div>

  </div>
</div>

<script>
/* ================= CONFIG ================= */
const apiURL =
"https://script.google.com/macros/s/AKfycbxKac_-Zjp71e3GCZOsdm1xtmzZOkYjmFQj9lyb-eeBSMmYaTEgGldnxKzQPlZADPFCGg/exec";

let allRows = [];
let weightChart;

/* ================= INIT CHART ================= */
function initChart() {
  const ctx = document.getElementById("weightChart").getContext("2d");
  const isMobile = window.innerWidth < 768;

  weightChart = new Chart(ctx, {
    type: "line",
    data: { labels: [], datasets: [] },
    options: {
      responsive: true,
      maintainAspectRatio: false, // IMPORTANT for mobile
      plugins: {
        legend: {
          position: isMobile ? "top" : "bottom",
          labels: {
            boxWidth: 12,
            font: {
              size: isMobile ? 10 : 12
            }
          }
        }
      },
      scales: {
        x: {
          ticks: {
            font: {
              size: isMobile ? 10 : 12
            }
          },
          title: {
            display: true,
            text: "Day (Weekly Reset)"
          }
        },
        y: {
          beginAtZero: true,
          ticks: {
            font: {
              size: isMobile ? 10 : 12
            }
          },
          title: {
            display: true,
            text: "Weight (g)"
          }
        }
      }
    }
  });
}


/* ================= LOAD DATA ================= */
async function fetchSheetData() {
  try {
    const res = await fetch(apiURL + "?view=month&t=" + Date.now());
    allRows = await res.json();

    populateWeekSelector();
    renderWeek(getLatestWeek());

    document.getElementById("status").innerText =
      "✅ Data loaded successfully";

  } catch (err) {
    console.error(err);
    document.getElementById("status").innerText = "❌ Failed to load data";
  }
}

/* ================= WEEK SELECTOR ================= */
function populateWeekSelector() {
  const select = document.getElementById("weekSelect");
  select.innerHTML = "";

  const totalWeeks = Math.ceil(allRows.length / 7);

  for (let w = 1; w <= totalWeeks; w++) {
    const opt = document.createElement("option");
    opt.value = w;
    opt.textContent = "Week " + w;
    select.appendChild(opt);
  }

  select.value = totalWeeks;

  select.onchange = () => {
    renderWeek(parseInt(select.value));
  };
}

function getLatestWeek() {
  return Math.ceil(allRows.length / 7);
}

/* ================= RENDER WEEK ================= */
function renderWeek(week) {
  const start = (week - 1) * 7;
  const weekRows = allRows.slice(start, start + 7);

  /* ---- TABLE HEADER ---- */
  document.querySelector("#sheetData thead").innerHTML = `
    <tr>
      <th>Day</th>
      ${[...Array(10)].map((_,i)=>`<th>Chick ${i+1}</th>`).join("")}
      <th>Feed (g)</th>
      <th>Gain (g)</th>
      <th>FCR</th>
    </tr>
  `;

  /* ---- TABLE BODY ---- */
  document.querySelector("#sheetData tbody").innerHTML =
    weekRows.map((r, i) => `
      <tr>
        <td>${i + 1}</td>
        ${[1,2,3,4,5,6,7,8,9,10].map(c =>
          `<td>${r["chick"+c] ?? ""} g</td>`
        ).join("")}
        <td>${r.feed ?? ""}</td>
        <td>${r.gain ?? ""}</td>
        <td>${r.fcr ?? ""}</td>
      </tr>
    `).join("");

  /* ---- CHART (ALL 10 CHICKS) ---- */
  weightChart.data.labels = weekRows.map((_, i) => "Day " + (i + 1));
  weightChart.data.datasets = [];

  for (let c = 1; c <= 10; c++) {
    weightChart.data.datasets.push({
      label: "Chick " + c,
      data: weekRows.map(r => Number(r["chick" + c]) || 0),
      borderWidth: window.innerWidth < 768 ? 1.5 : 2,
      tension: 0.4,
      fill: false
    });
  }

  weightChart.update();

  document.getElementById("status").innerText =
    `Showing Week ${week}`;
}

/* ================= START ================= */
initChart();
fetchSheetData();
</script>

</body>

</html>






